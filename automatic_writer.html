<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Universal Handwriting Animation</title>

<style>
body {
  background: #eceadc;
  font-family: Arial, sans-serif;
  padding: 20px;
  height: 3000px;
  overflow-y: auto;
}

#canvas {
  border: 1px solid #444;
  background: #fff;
  cursor: pointer;
  display: none; /* hidden until Start Writing */
  margin-bottom: 50px;
}

#inputArea {
  margin-bottom: 25px;
}

textarea {
  width: 100%;
  height: 350px;
  font-size: 22px;
  padding: 15px;
  border-radius: 10px;
  border: 1px solid #777;
  resize: vertical;
}

button {
  margin-top: 20px;
  padding: 15px 40px;
  font-size: 22px;
  background: #1d72ff;
  border: none;
  color: white;
  border-radius: 8px;
  cursor: pointer;
}
button:hover {
  background: #0c55cc;
}
</style>
</head>

<body>

<div id="inputArea">
  <h2>✍️ Universal Handwriting Animation</h2>
  <p>Paste ANY text below and click Start Writing</p>

  <textarea id="textInput" placeholder="Paste your post here..."></textarea>

  <button id="startBtn">Start Writing</button>
</div>

<canvas id="canvas" width="1100" height="2500"></canvas>

<script>
// ---------------------------------------------
// SETTINGS
// ---------------------------------------------
const FONT = "36px 'Comic Sans MS'";
const LINE_HEIGHT = 55;

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

// Load pen
let penImg = new Image();
penImg.src = "pen.jpg";

// ---------------------------------------------
// TEXT WRAPPING
// ---------------------------------------------
function wrapText(text, maxWidth) {
  ctx.font = FONT;

  const paragraphs = text.split("\n");  // keep line breaks
  const lines = [];

  paragraphs.forEach(par => {
    if (par.trim() === "") {
      lines.push("");
      return;
    }

    const words = par.split(" ");
    let line = "";

    words.forEach(w => {
      const test = line + w + " ";
      if (ctx.measureText(test).width > maxWidth) {
        lines.push(line);
        line = w + " ";
      } else {
        line = test;
      }
    });

    lines.push(line);
  });

  return lines;
}

// ---------------------------------------------
// HANDWRITING ANIMATION
// ---------------------------------------------
async function startAnimation() {
  const TEXT = document.getElementById("textInput").value;

  if (!TEXT.trim()) {
    alert("Please paste or type your post first.");
    return;
  }

  // Hide input area
  document.getElementById("inputArea").style.display = "none";

  // Show canvas
  canvas.style.display = "block";

  // Wait for pen
  while (!penImg.complete) {
    await new Promise(r => setTimeout(r, 50));
  }

  ctx.fillStyle = "#fff";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  const lines = wrapText(TEXT, 900);

  let drawnLines = [];
  let yStart = 100;

  for (let lineIndex = 0; lineIndex < lines.length; lineIndex++) {

    const currentLine = lines[lineIndex];
    drawnLines.push("");  

    for (let i = 0; i < currentLine.length; i++) {

      drawnLines[lineIndex] += currentLine[i];

      ctx.fillStyle = "#fff";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#000";
      ctx.font = FONT;

      for (let k = 0; k < drawnLines.length; k++) {
        ctx.fillText(drawnLines[k], 100, yStart + k * LINE_HEIGHT);
      }

      const textWidth = ctx.measureText(drawnLines[lineIndex]).width;

      ctx.drawImage(
        penImg,
        100 + textWidth,
        yStart + lineIndex * LINE_HEIGHT - 40,
        60, 60
      );

      window.scrollTo({
        top: yStart + lineIndex * LINE_HEIGHT - 200,
        behavior: "smooth"
      });

      await new Promise(r => setTimeout(r, 40)); // pen speed
    }

    drawnLines[lineIndex] += "";
  }
}

// Start button
document.getElementById("startBtn").onclick = startAnimation;
</script>

</body>
</html>
